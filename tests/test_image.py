# third-party
import pytest
import numpy as np
from loguru import logger
from scipy.stats import multivariate_normal

# local
from motley.image import AnsiImage
from recipes.testing import Expected, mock


logger.enable('motley.image')
logger.enable('recipes')

# r = np.random.randint(0, 256, (10, 10))
# im = AnsiImage(r, frame=True).render()
# im = BinaryImage(r >= 128).render()

# ---------------------------------------------------------------------------- #


def make_gaussian_image(size=(10, 10)):
    # 2D Gaussian
    mu = (0, 0)
    covm = np.array([[0.5,  1.2],
                     [0.6,  1.2]])
    rv = multivariate_normal(mu, covm)
    r, c = size
    Y, X = np.mgrid[-3:3:r * 1j, -3:3:c * 1j]
    grid = np.array([X, Y])
    return rv.pdf(grid.transpose(1, 2, 0)).T


@pytest.fixture(scope='module')
def gaussian2d():
    return make_gaussian_image()


def format_with_overlay(frame, **kws):
    gaussian2d = make_gaussian_image()
    img = AnsiImage(gaussian2d)
    img.overlay(gaussian2d > 0.01, 'red')
    return img.format(frame=frame, **kws)


test_display = Expected(format_with_overlay)({
    mock(frame=''):
        '\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\n\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;2;85m  \x1b[0m\n\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;70;9;92;4;31m  \x1b[0m\x1b[31;48;2;71;22;105m▏ \x1b[0m\x1b[31;48;2;71;22;105m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m\n\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[31;48;2;70;14;97m▏ \x1b[0m\x1b[;48;2;66;64;133m  \x1b[0m\x1b[;48;2;42;119;142m  \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;71;38;118;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m\n\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;5;88;4;31m  \x1b[0m\x1b[31;48;2;70;45;124m▏ \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;66;64;133;4;31m ▕\x1b[0m\x1b[;48;2;69;8;91m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\n\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;8;91;4;31m  \x1b[0m\x1b[31;48;2;66;64;133m▏ \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;70;45;124;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\n\x1b[;48;2;69;5;88m  \x1b[0m\x1b[31;48;2;71;38;118m▏ \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;42;119;142;4;31m  \x1b[0m\x1b[;48;2;66;64;133;4;31m  \x1b[0m\x1b[;48;2;70;14;97;4;31m ▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\n\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;71;22;105;4;31m▏ \x1b[0m\x1b[;48;2;71;22;105;4;31m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\n\x1b[;48;2;68;2;85m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\n\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\n',
    mock(frame='_'):
        '\x1b[;4m  \x1b[0m\x1b[;4m  \x1b[0m\x1b[;4m  \x1b[0m\x1b[;4m  \x1b[0m\x1b[;4m  \x1b[0m\x1b[;4m  \x1b[0m\x1b[;4m  \x1b[0m\x1b[;4m  \x1b[0m\x1b[;4m  \x1b[0m\x1b[;4m  \x1b[0m\n\x1b[;48;2;68;1;84m▏ \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m ▕\x1b[0m\n\x1b[;48;2;68;1;84m▏ \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;2;85m ▕\x1b[0m\n\x1b[;48;2;68;1;84m▏ \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;70;9;92;4;31m  \x1b[0m\x1b[31;48;2;71;22;105m▏ \x1b[0m\x1b[31;48;2;71;22;105m ▕\x1b[0m\x1b[;48;2;70;9;92m ▕\x1b[0m\n\x1b[;48;2;68;1;84m▏ \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[31;48;2;70;14;97m▏ \x1b[0m\x1b[;48;2;66;64;133m  \x1b[0m\x1b[;48;2;42;119;142m  \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;71;38;118;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m ▕\x1b[0m\n\x1b[;48;2;68;1;84m▏ \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;5;88;4;31m  \x1b[0m\x1b[31;48;2;70;45;124m▏ \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;66;64;133;4;31m ▕\x1b[0m\x1b[;48;2;69;8;91m  \x1b[0m\x1b[;48;2;68;1;84m ▕\x1b[0m\n\x1b[;48;2;68;1;84m▏ \x1b[0m\x1b[;48;2;69;8;91;4;31m  \x1b[0m\x1b[31;48;2;66;64;133m▏ \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;70;45;124;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m ▕\x1b[0m\n\x1b[;48;2;69;5;88m▏ \x1b[0m\x1b[31;48;2;71;38;118m▏ \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;42;119;142;4;31m  \x1b[0m\x1b[;48;2;66;64;133;4;31m  \x1b[0m\x1b[;48;2;70;14;97;4;31m ▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m ▕\x1b[0m\n\x1b[;48;2;70;9;92m▏ \x1b[0m\x1b[;48;2;71;22;105;4;31m▏ \x1b[0m\x1b[;48;2;71;22;105;4;31m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m ▕\x1b[0m\n\x1b[;48;2;68;2;85m▏ \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m ▕\x1b[0m\n\x1b[;48;2;68;1;84;4m▏ \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m ▕\x1b[0m\n',
    mock(frame='-'):
        '╭────────────────────╮\n│\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m│\n│\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;2;85m  \x1b[0m│\n│\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;70;9;92;4;31m  \x1b[0m\x1b[31;48;2;71;22;105m▏ \x1b[0m\x1b[31;48;2;71;22;105m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m│\n│\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[31;48;2;70;14;97m▏ \x1b[0m\x1b[;48;2;66;64;133m  \x1b[0m\x1b[;48;2;42;119;142m  \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;71;38;118;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m│\n│\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;5;88;4;31m  \x1b[0m\x1b[31;48;2;70;45;124m▏ \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;66;64;133;4;31m ▕\x1b[0m\x1b[;48;2;69;8;91m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m│\n│\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;8;91;4;31m  \x1b[0m\x1b[31;48;2;66;64;133m▏ \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;70;45;124;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m│\n│\x1b[;48;2;69;5;88m  \x1b[0m\x1b[31;48;2;71;38;118m▏ \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;42;119;142;4;31m  \x1b[0m\x1b[;48;2;66;64;133;4;31m  \x1b[0m\x1b[;48;2;70;14;97;4;31m ▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m│\n│\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;71;22;105;4;31m▏ \x1b[0m\x1b[;48;2;71;22;105;4;31m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m│\n│\x1b[;48;2;68;2;85m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m│\n│\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m│\n╰────────────────────╯',
    mock(frame='='):
        '╔════════════════════╗\n║\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m║\n║\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;2;85m  \x1b[0m║\n║\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;70;9;92;4;31m  \x1b[0m\x1b[31;48;2;71;22;105m▏ \x1b[0m\x1b[31;48;2;71;22;105m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m║\n║\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[31;48;2;70;14;97m▏ \x1b[0m\x1b[;48;2;66;64;133m  \x1b[0m\x1b[;48;2;42;119;142m  \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;71;38;118;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m║\n║\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;5;88;4;31m  \x1b[0m\x1b[31;48;2;70;45;124m▏ \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;66;64;133;4;31m ▕\x1b[0m\x1b[;48;2;69;8;91m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m║\n║\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;8;91;4;31m  \x1b[0m\x1b[31;48;2;66;64;133m▏ \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;70;45;124;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m║\n║\x1b[;48;2;69;5;88m  \x1b[0m\x1b[31;48;2;71;38;118m▏ \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;42;119;142;4;31m  \x1b[0m\x1b[;48;2;66;64;133;4;31m  \x1b[0m\x1b[;48;2;70;14;97;4;31m ▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m║\n║\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;71;22;105;4;31m▏ \x1b[0m\x1b[;48;2;71;22;105;4;31m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m║\n║\x1b[;48;2;68;2;85m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m║\n║\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m║\n╚════════════════════╝',
    mock(frame='+'):
        '\x1b[;4m   ⃓  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓ \x1b[0m\n┤\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m├\n┤\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;2;85m  \x1b[0m├\n┤\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;70;9;92;4;31m  \x1b[0m\x1b[31;48;2;71;22;105m▏ \x1b[0m\x1b[31;48;2;71;22;105m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m├\n┤\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[31;48;2;70;14;97m▏ \x1b[0m\x1b[;48;2;66;64;133m  \x1b[0m\x1b[;48;2;42;119;142m  \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;71;38;118;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m├\n┤\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;5;88;4;31m  \x1b[0m\x1b[31;48;2;70;45;124m▏ \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;66;64;133;4;31m ▕\x1b[0m\x1b[;48;2;69;8;91m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m├\n┤\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;8;91;4;31m  \x1b[0m\x1b[31;48;2;66;64;133m▏ \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;70;45;124;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m├\n┤\x1b[;48;2;69;5;88m  \x1b[0m\x1b[31;48;2;71;38;118m▏ \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;42;119;142;4;31m  \x1b[0m\x1b[;48;2;66;64;133;4;31m  \x1b[0m\x1b[;48;2;70;14;97;4;31m ▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m├\n┤\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;71;22;105;4;31m▏ \x1b[0m\x1b[;48;2;71;22;105;4;31m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m├\n┤\x1b[;48;2;68;2;85m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m├\n\x1b[;4m┤\x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;4m├\x1b[0m\n  ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ',
    mock(frame='['):
        '\x1b[;4m  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓  ⃓\x1b[0m\n\x1b[;4m▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;4m▏\x1b[0m\n\x1b[;4m▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;2;85m  \x1b[0m\x1b[;4m▏\x1b[0m\n\x1b[;4m▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[;48;2;70;9;92;4;31m  \x1b[0m\x1b[31;48;2;71;22;105m▏ \x1b[0m\x1b[31;48;2;71;22;105m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;4m▏\x1b[0m\n\x1b[;4m▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84;4;31m  \x1b[0m\x1b[31;48;2;70;14;97m▏ \x1b[0m\x1b[;48;2;66;64;133m  \x1b[0m\x1b[;48;2;42;119;142m  \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;71;38;118;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m\x1b[;4m▏\x1b[0m\n\x1b[;4m▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;5;88;4;31m  \x1b[0m\x1b[31;48;2;70;45;124m▏ \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;66;64;133;4;31m ▕\x1b[0m\x1b[;48;2;69;8;91m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;4m▏\x1b[0m\n\x1b[;4m▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;69;8;91;4;31m  \x1b[0m\x1b[31;48;2;66;64;133m▏ \x1b[0m\x1b[;48;2;62;188;115m  \x1b[0m\x1b[;48;2;253;231;36m  \x1b[0m\x1b[;48;2;31;161;135m  \x1b[0m\x1b[;48;2;70;45;124;4;31m ▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;4m▏\x1b[0m\n\x1b[;4m▕\x1b[0m\x1b[;48;2;69;5;88m  \x1b[0m\x1b[31;48;2;71;38;118m▏ \x1b[0m\x1b[;48;2;49;102;141m  \x1b[0m\x1b[;48;2;42;119;142;4;31m  \x1b[0m\x1b[;48;2;66;64;133;4;31m  \x1b[0m\x1b[;48;2;70;14;97;4;31m ▕\x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;4m▏\x1b[0m\n\x1b[;4m▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;71;22;105;4;31m▏ \x1b[0m\x1b[;48;2;71;22;105;4;31m ▕\x1b[0m\x1b[;48;2;70;9;92m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;4m▏\x1b[0m\n\x1b[;4m▕\x1b[0m\x1b[;48;2;68;2;85m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;48;2;68;1;84m  \x1b[0m\x1b[;4m▏\x1b[0m\n\x1b[;4;4m▕\x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;48;2;68;1;84;4m  \x1b[0m\x1b[;4;4m▏\x1b[0m\n ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ ᑊ',
})

# logger.enable('motley')
FRAMES = ('', '_', '-', '=', '+', '[', 'E')

@pytest.mark.parametrize('frame', FRAMES)
def test_edge_mask(frame):
    mask = np.array(
        [[False, False, False, False, False, False, False, False, False, False],
         [False, False, False, False, False, False, False, False, False, False],
         [False, False, False, False,  True, False, False, False, False, False],
         [False, False, False,  True,  True,  True, False, False, False, False],
         [False, False,  True,  True,  True,  True,  True,  True, False, False],
         [False, False,  True,  True,  True,  True,  True,  True, False, False],
         [False, False, False, False,  True, False, False, False, False, False]]
    )
    img = AnsiImage(np.ones(mask.shape), frame=frame)
    img.overlay(mask, 'r')
    print(img)


if __name__ == "__main__":
    for frame in FRAMES:   #
        print(frame * 80)
        xticks = [''] * 11
        xticks[::2] = range(102, 113, 2)
        yticks = [''] * 11
        yticks[::2] = range(99, 110, 2)
        img = format_with_overlay(frame,
                                  xticks=xticks,
                                  yticks=yticks)
        #    yticks=range(10)[::-1])
        print(img)
        # print(repr(img))
        print('*' * 80)
        break
